{"version":3,"sources":["OfflineManager.ts"],"names":["NativeEventEmitter","NativeModules","RNMWZOfflineManager","count","createOfflineManager","mapwizeConfiguration","contextId","OfflineManagerImp","constructor","downloadData","offlineRegion","onProgress","eventEmitter","eventListener","addListener","e","downloadTaskListenerId","progress","progressListeners","progressListenerId","nextProgressListenerId","Promise","resolve","reject","then","offlineRegion1","remove","message","updateData","hasOfflineRegion","venue","universe","getOfflineRegion","getOfflineRegions","removeData","checkForUpdate"],"mappings":"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","sourcesContent":["import { NativeEventEmitter, NativeModules } from 'react-native'\n\nimport type {\n  Venue,\n  MapwizeConfiguration,\n  OfflineManager,\n  Universe,\n  OfflineRegion,\n  DownloadDataOptions,\n} from './types'\n\nconst { RNMWZOfflineManager } = NativeModules\n\nlet count: number = 0\nexport const createOfflineManager = (\n  mapwizeConfiguration: MapwizeConfiguration\n): OfflineManager => {\n  let contextId = 'context-' + count++\n  RNMWZOfflineManager.createOfflineManager(mapwizeConfiguration, contextId)\n  return new OfflineManagerImp(contextId)\n}\nclass OfflineManagerImp implements OfflineManager {\n  contextId: string\n  progressListeners: {\n    [key: string]: (progress: number) => void\n  } = {}\n  nextProgressListenerId: number = 0\n  constructor(contextId: string) {\n    this.contextId = contextId\n  }\n  downloadData(\n    offlineRegion: OfflineRegion,\n    onProgress: (progress: number) => void\n  ): Promise<OfflineRegion> {\n    const eventEmitter = new NativeEventEmitter(RNMWZOfflineManager)\n    const eventListener = eventEmitter.addListener(\n      'OfflineManagerEvent',\n      (e) => {\n        const { downloadTaskListenerId, progress, contextId } = e\n        if (contextId === this.contextId) {\n          //Handle only this instance's events\n          this.progressListeners[downloadTaskListenerId] &&\n            this.progressListeners[downloadTaskListenerId](progress)\n        }\n      }\n    )\n    const progressListenerId = '' + this.nextProgressListenerId++\n    this.progressListeners[progressListenerId] = onProgress\n    return new Promise((resolve, reject) =>\n      RNMWZOfflineManager.downloadData(\n        this.contextId,\n        progressListenerId,\n        offlineRegion\n      ).then(\n        (offlineRegion1: OfflineRegion) => {\n          eventListener.remove()\n          delete this.progressListeners[progressListenerId]\n          resolve(offlineRegion1)\n        },\n        (message: string) => {\n          eventListener.remove()\n          delete this.progressListeners[progressListenerId]\n          reject(message)\n        }\n      )\n    )\n  }\n  updateData(\n    offlineRegion: OfflineRegion,\n    onProgress: (progress: number) => void\n  ): Promise<OfflineRegion> {\n    const eventEmitter = new NativeEventEmitter(RNMWZOfflineManager)\n    const eventListener = eventEmitter.addListener(\n      'OfflineManagerEvent',\n      (e) => {\n        const { downloadTaskListenerId, progress, contextId } = e\n        if (contextId === this.contextId) {\n          //Handle only this instance's events\n          this.progressListeners[downloadTaskListenerId] &&\n            this.progressListeners[downloadTaskListenerId](progress)\n        }\n      }\n    )\n    const progressListenerId = '' + this.nextProgressListenerId++\n    this.progressListeners[progressListenerId] = onProgress\n    return new Promise((resolve, reject) =>\n      RNMWZOfflineManager.updateData(\n        this.contextId,\n        progressListenerId,\n        offlineRegion\n      ).then(\n        (offlineRegion: OfflineRegion) => {\n          eventListener.remove()\n          delete this.progressListeners[progressListenerId]\n          resolve(offlineRegion)\n        },\n        (message: string) => {\n          eventListener.remove()\n          delete this.progressListeners[progressListenerId]\n          reject(message)\n        }\n      )\n    )\n  }\n  hasOfflineRegion(venue: Venue, universe: Universe): Promise<boolean> {\n    return RNMWZOfflineManager.hasOfflineRegion(this.contextId, venue, universe)\n  }\n\n  getOfflineRegion(venue: Venue, universe: Universe): Promise<OfflineRegion> {\n    return RNMWZOfflineManager.getOfflineRegion(this.contextId, venue, universe)\n  }\n\n  getOfflineRegions(): Promise<OfflineRegion[]> {\n    return RNMWZOfflineManager.getOfflineRegions(this.contextId)\n  }\n\n  removeData(offlineRegion: OfflineRegion): Promise<void> {\n    return RNMWZOfflineManager.removeData(this.contextId, offlineRegion)\n  }\n\n  checkForUpdate(offlineRegion: OfflineRegion): Promise<Boolean> {\n    return RNMWZOfflineManager.checkForUpdate(this.contextId, offlineRegion)\n  }\n}\n\nexport default createOfflineManager\n"]}